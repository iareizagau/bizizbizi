{% extends 'core/base.html' %}

{% load static %}

{% block title %}Hasiera{% endblock %}

{% block content %}
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>

<style>
    body {
        padding: 5;
        margin: 0;
    }
    html, body {
        height: 60%;
        width: 100vw;
    }
    #map {
  position: relative;
  border: 1px solid black;
  border-radius: 0px;
  height: 350px;  /* or as desired */
  width: 100%;  /* This means "100% of the width of its container", the .col-md-8 */
}
</style>
<style>
body {
  font-family: Arial;
  margin: 0;
}

* {
  box-sizing: border-box;
}

img {
  vertical-align: middle;
}

/* Position the image container (needed to position the left and right arrows) */
.container {
  position: relative;
}

/* Hide the images by default */
.mySlides {
  display: none;
}

/* Add a pointer when hovering over the thumbnail images */
.cursor {
  cursor: pointer;
}

/* Next & previous buttons */
.prev,
.next {
  cursor: pointer;
  position: absolute;
  top: 40%;
  width: auto;
  padding: 16px;
  margin-top: -50px;
  color: white;
  font-weight: bold;
  font-size: 20px;
  border-radius: 0 3px 3px 0;
  user-select: none;
  -webkit-user-select: none;
}

/* Position the "next button" to the right */
.next {
  right: 0;
  border-radius: 3px 0 0 3px;
}

/* On hover, add a black background color with a little bit see-through */
.prev:hover,
.next:hover {
  background-color: rgba(0, 0, 0, 0.8);
}

/* Number text (1/3 etc) */
.numbertext {
  color: #f2f2f2;
  font-size: 12px;
  padding: 8px 12px;
  position: absolute;
  top: 0;
}

/* Container for image text */
.caption-container {
  text-align: center;
  background-color: #222;
  padding: 2px 16px;
  color: white;
}

.row:after {
  content: "";
  display: table;
  clear: both;
}

/* Six columns side by side */
.column {
  float: left;
  width: 16.66%;
}

/* Add a transparency effect for thumnbail images */
.demo {
  opacity: 0.6;
}

.active,
.demo:hover {
  opacity: 1;
}
</style>
<div class="container-fluid text-center">
    <div class="row">
        <div class="col-md-6">
          <div id="map"></div>
        </div>
        <div class="col-6 col-md-4">
            {{ biketravel.title }}
            <div class="d-flex justify-content-around text-center mb-4" id="weather">
        </div>
    </div>
    </div>
    <div class="row">
        <div class="col-md-6">
            <div class="container">
        {% if biketravel.image1.url != None %}
          <div class="mySlides">
            <div class="numbertext">1 / 6</div>
            <img src="{{ biketravel.image1.url }}" style="width:100%">
          </div>
        {% endif %}

        {% if biketravel.image2.url != None %}
          <div class="mySlides">
            <div class="numbertext">2 / 6</div>
            <img src="{{ biketravel.image2.url }}" style="width:60%">
          </div>
        {% endif %}
        {% if biketravel.image3.url != None %}
          <div class="mySlides">
            <div class="numbertext">3 / 6</div>
            <img src="{{ biketravel.image3.url }}" style="width:60%">
          </div>
        {% endif %}
        {% if biketravel.image4.url != None %}
          <div class="mySlides">
            <div class="numbertext">4 / 6</div>
            <img src="{{ biketravel.image4.url }}" style="width:60%">
          </div>
        {% endif %}
        {% if biketravel.image5.url != None %}
          <div class="mySlides">
            <div class="numbertext">5 / 6</div>
            <img src="{{ biketravel.image5.url }}" style="width:60%">
          </div>
        {% endif %}
        {% if biketravel.image6.url != None %}
          <div class="mySlides">
            <div class="numbertext">6 / 6</div>
            <img src="{{ biketravel.image2.url }}" style="width:60%">
          </div>
        {% endif %}
          <a class="prev" onclick="plusSlides(-1)">❮</a>
          <a class="next" onclick="plusSlides(1)">❯</a>

          <div class="caption-container">
            <p id="caption"></p>
          </div>

          <div class="row">
{% if biketravel.image1.url != None %}
            <div class="column">
              <img class="demo cursor" src="{{ biketravel.image1.url }}" style="width:100%" onclick="currentSlide(1)" alt="{{biketravel.title}}">
            </div>
        {% endif %}
{% if biketravel.image2.url != None %}
            <div class="column">
              <img class="demo cursor" src="{{ biketravel.image2.url }}" style="width:100%" onclick="currentSlide(2)" alt="{{biketravel.title}}">
            </div>
        {% endif %}
{% if biketravel.image3.url != None %}
            <div class="column">
              <img class="demo cursor" src="{{ biketravel.image3.url }}" style="width:100%" onclick="currentSlide(3)" alt="{{biketravel.title}}">
            </div>
        {% endif %}
{% if biketravel.image4.url != None %}
            <div class="column">
              <img class="demo cursor" src="{{ biketravel.image4.url }}" style="width:100%" onclick="currentSlide(4)" alt="{{biketravel.title}}">
            </div>
        {% endif %}
{% if biketravel.image5.url != None %}
            <div class="column">
              <img class="demo cursor" src="{{ biketravel.image5.url }}" style="width:100%" onclick="currentSlide(5)" alt="{{biketravel.title}}">
            </div>
        {% endif %}
{% if biketravel.image6.url != None %}
            <div class="column">
              <img class="demo cursor" src="{{ biketravel.image6.url }}" style="width:100%" onclick="currentSlide(6)" alt="{{biketravel.title}}">
            </div>
        {% endif %}

          </div>
        </div>
        </div>
        <div class="col-md-6">

            What is Lorem Ipsum?

            Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged. It was popularised in the 1960s with the release of Letraset sheets containing Lorem Ipsum passages, and more recently with desktop publishing software like Aldus PageMaker including versions of Lorem Ipsum.
        </div>
    </div>
</div>


<script src="https://unpkg.com/leaflet-routing-machine@3.2.7/dist/leaflet-routing-machine.js"></script>
<script type="text/javascript">
        console.log("step");

        {% if biketravel.gpx == False %}
            var map = L.map('map').setView([{{ biketravel.end_latitude }},{{ biketravel.end_longitude }}], 10);
                    console.log("step2");
        {% else %}
                console.log("step3");

            var map = L.map('map').setView([{{ biketravel.latitude }},{{ biketravel.longitude }}], 10);
        {% endif %}
        var ocm = L.tileLayer('https://tile.thunderforest.com/cycle/{z}/{x}/{y}.png?apikey=cd56115c8eca4973aa4117461a378787', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        });

        var osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        });

        var OpenTopoMap = L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
            attribution: 'Map data: &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, <a href="http://viewfinderpanoramas.org">SRTM</a> | Map style: &copy; <a href="https://opentopomap.org">OpenTopoMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)'
        });

        // water color
        var watercolor = L.tileLayer('https://stamen-tiles-{s}.a.ssl.fastly.net/watercolor/{z}/{x}/{y}.{ext}', {
            attribution: 'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
            subdomains: 'abcd',
            minZoom: 1,
            maxZoom: 16,
            ext: 'jpg'
        });

        // dark map
        var dark = L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
            subdomains: 'abcd',
            maxZoom: 19
        });
        // google street
        googleStreets = L.tileLayer('http://{s}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}', {
            maxZoom: 20,
            subdomains: ['mt0', 'mt1', 'mt2', 'mt3']
        });

        //google satellite
        googleSat = L.tileLayer('http://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', {
            maxZoom: 20,
            subdomains: ['mt0', 'mt1', 'mt2', 'mt3']
        });

        var OpenTopoMap = L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
            attribution: 'Map data: &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, <a href="http://viewfinderpanoramas.org">SRTM</a> | Map style: &copy; <a href="https://opentopomap.org">OpenTopoMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)'
        });


        /*==============================================
                        LAYER CONTROL
        ================================================*/
        var baseMaps = {
            "OpenCycleMap": ocm,
            "OSM": osm,
            'Dark': dark,
            'Google Street': googleStreets,
            "Google Satellite": googleSat,
            "Topo Map": OpenTopoMap,
        };

        var tiles = L.tileLayer('https://tile.thunderforest.com/cycle/{z}/{x}/{y}.png?apikey=cd56115c8eca4973aa4117461a378787', {
            attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',

        }).addTo(map);
        console.log("step");
        {% if biketravel.gpx == False %}
            console.log("holllaaa");
            var startIcon = L.icon({
                iconUrl: 'media/img/start_flag.png',
                iconSize: [70, 70]
            })

            var bikeIcon = L.icon({
                iconUrl: 'media/img/bike.png',
                iconSize: [70, 70]
            })

            var LeafIconWeather = L.Icon.extend({
                options: {
                    iconSize:     [100, 100],
                    iconAnchor:   [10, 0],
                    popupAnchor:  [-0, -0]
                }
            });
                var markers = L.markerClusterGroup({
                    disableClusteringAtZoom: 5,
                    maxClusterRadius: 10000,
                    animateAddingMarkers: true
                });


                var marker = L.marker([{{ biketravel.start_latitude }},{{ biketravel.start_longitude }}]).addTo(map);
                var marker = L.marker([{{ biketravel.end_latitude }},{{ biketravel.end_longitude }}]).addTo(map);

                    var router = L.routing.osrmv1({profile: "bike"})

                    var waypoints = [];
                    waypoints.push(L.routing.waypoint([{{ biketravel.start_latitude }},{{ biketravel.start_longitude }}]));
                    {% if bikespot.mid_latitude != None %}
                        waypoints.push(L.routing.waypoint([{{ biketravel.mid_latitude }},{{ biketravel.mid_longitude }}]));
                    {% endif %}
                    waypoints.push(L.routing.waypoint([{{ biketravel.end_latitude }},{{ biketravel.end_longitude }}]));

                    router.route(waypoints, function(err, routes) {
                                              if (err || routes.length < 1) {
                                                return console.error(err)
                                              }

                      var line = L.routing.line(routes[0],{styles:[{color: 'orange', opacity: 1, weight: 5}]}).addTo(map)
                        map.fitBounds(line.getBounds())
                    })



                    var markersWeather = L.markerClusterGroup({
                    disableClusteringAtZoom: 10,
                    maxClusterRadius: 100,
                    animateAddingMarkers: true
                });

                        window.addEventListener('load', function(name){
                            fetch('https://api.openweathermap.org/data/2.5/weather?lat={{ bikespot.start_latitude }}&&lon={{ bikespot.start_longitude }}&units=metric&appid=32ce3717017406682b290a5dd99fbc99&lang=eu')
                            .then(response => response.json())
                            .then(data => {
                            if (data['cod'] == 200){
                            console.log(data['weather'][0]['icon']);
                            console.log("http://openweathermap.org/img/wn/"+data['weather'][0]['icon']+"@2x.png");
                            var img_owm = "http://openweathermap.org/img/wn/"+data['weather'][0]['icon']+"@2x.png";
                                var weatherIcon = new LeafIconWeather({iconUrl: img_owm});
                                markersWeather.addLayer(L.marker([{{ bikespot.start_latitude }},{{ bikespot.start_longitude }}], {icon: weatherIcon}));
                            }
                            })
                        })

                        window.addEventListener('load', function(name){
                            fetch('https://api.openweathermap.org/data/2.5/weather?lat={{ bikespot.end_latitude }}&&lon={{ bikespot.end_longitude }}&units=metric&appid=32ce3717017406682b290a5dd99fbc99&lang=eu')
                            .then(response => response.json())
                            .then(data => {
                            if (data['cod'] == 200){
                            console.log(data['weather'][0]['icon']);
                            console.log("http://openweathermap.org/img/wn/"+data['weather'][0]['icon']+"@2x.png");
                            var img_owm = "http://openweathermap.org/img/wn/"+data['weather'][0]['icon']+"@2x.png";
                                var weatherIcon = new LeafIconWeather({iconUrl: img_owm});
                                markersWeather.addLayer(L.marker([{{ bikespot.end_latitude }},{{ bikespot.end_longitude }}], {icon: weatherIcon}));
                            }
                            })
                        })

                    map.addLayer(markersWeather);

                    var overlayMaps = {
                        "Eguraldia": markersWeather,
                    };

                    L.control.layers(baseMaps, overlayMaps, { collapsed: true }).addTo(map);

                    L.control.locate({
                        flyTo: true,
                        keepCurrentZoomLevel: true,
                        initialZoomLevel: 10
                        }).addTo(map);

        {% else %}
                console.log("kaixo");

             console.log('{{ biketravel.gpx_path.url }}');
            var gpx = '{{ biketravel.gpx_path.url }}'; // URL to your GPX file or the GPX itself
            new L.GPX(gpx, {async: true,
                            marker_options: {
                                startIconUrl: '{{none}}', //'{{ ic.start_flag.url }}',
                                endIconUrl: '{{none}}', //{{ ico.end_flag.url }}',
                                shadowUrl: '{{none}}'
                                },
                            polyline_options: {
                                color: '{{ color }}',
                                opacity: 0.75,
                                weight: 3,
                                lineCap: 'round'
                                },
                }).on('loaded', function(e) {
            }).addTo(map).bindPopup("<a href=#>test</a><br>");

        {% endif %}
        map.on('mouseover', function ()
        {
            console.log('your mouse is over the map')
        })

</script>
<!--Jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>
<!-- Owl Carousel -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"></script>
<!-- custom JS code after importing jquery and owl -->
<script>
    var weather = document.querySelector('.weather');
    var temp = document.querySelector('.temp');
    var wind = document.querySelector('.wind');
    var icon = document.querySelector('.icon');
    var datetime = document.querySelector('.datetime');
    {% if biketravel.gpx == True %}
        console.log("gpx true")
        var latitude = {{ biketravel.latitude }};
        var longitude = {{ biketravel.longitude }};
    {% else %}
        var latitude = {{ biketravel.end_latitude }};
        var longitude = {{ biketravel.end_longitude }};
    {% endif %}
    var url = 'https://api.openweathermap.org/data/2.5/onecall?lat=' + latitude + '&&lon=' + longitude + '&&exclude=current,hourly,minutely,alerts&units=metric&appid=32ce3717017406682b290a5dd99fbc99'
    console.log(url);
    window.addEventListener('load', function(name){
    fetch(url)
    .then(response => response.json())
    .then(data => {
        console.log(data);
        var days = ['Igandea','Astelehena','Asteartea','Asteazkena','Osteguna','Ostirala','larunbata'];
        const weather = document.getElementById('weather');
        var html = "";
        for (var i=0;i<7;i++) {
            var iconValue = data['daily'][i]['weather'][0]['icon'];
            var img = "http://openweathermap.org/img/wn/"+iconValue+"@2x.png";
            var temperatura = data['daily'][i]['temp']['day'];
            temperatura = Math.round(temperatura);
            console.log(temperatura);
            var dateFromTimeStamp = new Date(data['daily'][i]['dt'] * 1000);
            if (i < 3)
            {
                html += "<div class='flex-column'>"
            }
            else
            {
                html += "<div class='flex-column d-none d-sm-block'>"
            }
            html += "<p style='margin-bottom: 0'>" + temperatura + "&#8451</p>" +
            "<img src="+img+"></img>" +
            "<p style='margin-bottom: 0'>" + days[dateFromTimeStamp.getDay()] + "</p>" +
            "</div>";
        }
        weather.innerHTML = html;

        })
    })



</script>
<script type="text/javascript">
let slideIndex = 1;
showSlides(slideIndex);

function plusSlides(n) {
  showSlides(slideIndex += n);
}

function currentSlide(n) {
  showSlides(slideIndex = n);
}

function showSlides(n) {
  let i;
  let slides = document.getElementsByClassName("mySlides");
  let dots = document.getElementsByClassName("demo");
  let captionText = document.getElementById("caption");
  if (n > slides.length) {slideIndex = 1}
  if (n < 1) {slideIndex = slides.length}
  for (i = 0; i < slides.length; i++) {
    slides[i].style.display = "none";
  }
  for (i = 0; i < dots.length; i++) {
    dots[i].className = dots[i].className.replace(" active", "");
  }
  slides[slideIndex-1].style.display = "block";
  dots[slideIndex-1].className += " active";
  captionText.innerHTML = dots[slideIndex-1].alt;
}
</script>
{% endblock %}


